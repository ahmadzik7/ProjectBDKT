<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Input Gramasi 125 Pcs - Quality Control</title>
  <style>
    :root {
      --bg: #121212;
      --card: #1e1e1e;
      --text: #ffffff;
      --primary: #2858dd;
      --accent: #bbdefb;
      --border: #333;
      --hover: #2a2a2a;
      --success: #1a521a;
      --warning: #523a0a;
      --error: #521a1a;
      --filler1: #2196F3;
      --filler2: #4CAF50;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    body {
      background: var(--bg);
      color: var(--text);
      padding: 20px;
      min-height: 100vh;
    }
    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: var(--card);
      border-radius: 12px;
      padding: 25px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.3);
    }
    header {
      text-align: center;
      margin-bottom: 30px;
      padding: 15px;
      background: linear-gradient(135deg, var(--primary), #1b5e20);
      border-radius: 8px;
    }
    h1 {
      font-size: 1.8rem;
      font-weight: bold;
      letter-spacing: 1px;
      text-transform: uppercase;
    }
    .form-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 25px;
    }
    @media (max-width: 1200px) {
      .form-section {
        grid-template-columns: 1fr;
      }
    }
    .input-area {
      background: #1a1a1a;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    .summary-area {
      background: #1a1a1a;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    .form-group {
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--accent);
    }
    input, select {
      width: 100%;
      padding: 14px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      font-size: 16px;
      transition: all 0.2s ease;
    }
    input:focus, select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(187, 222, 251, 0.2);
    }
    input[readonly] {
      background: #2a2a2a;
      cursor: not-allowed;
    }
    button {
      width: 100%;
      padding: 14px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      margin-top: 10px;
      transition: background 0.2s;
    }
    button:hover:not(:disabled) {
      background: #1b5e20;
    }
    button:disabled {
      background: #555;
      cursor: not-allowed;
    }
    .btn-group {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    .btn-secondary {
      background: #424242;
    }
    .btn-secondary:hover {
      background: #555;
    }
    .btn-success {
      background: #1a521a;
    }
    .btn-success:hover {
      background: #2a7a2a;
    }
    .btn-warning {
      background: #523a0a;
    }
    .btn-warning:hover {
      background: #7a540d;
    }
    .btn-filler1 {
      background: var(--filler1);
    }
    .btn-filler1:hover {
      background: #1976D2;
    }
    .btn-filler2 {
      background: var(--filler2);
    }
    .btn-filler2:hover {
      background: #388E3C;
    }
    .message {
      padding: 12px;
      margin: 15px 0;
      border-radius: 6px;
      text-align: center;
      font-weight: bold;
      display: none;
    }
    .success { 
      background: var(--success); 
      color: #bbdefb; 
      display: block;
    }
    .error { 
      background: var(--error); 
      color: #ffcccb; 
      display: block;
    }
    .warning {
      background: var(--warning);
      color: #fff8e1;
      display: block;
    }
    .grid-container {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 8px;
      margin-top: 15px;
      max-height: 500px;
      overflow-y: auto;
      padding-right: 5px;
    }
    .weight-input-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .weight-input-label {
      font-size: 10px;
      color: var(--accent);
      margin-bottom: 2px;
      width: 100%;
      text-align: center;
      background: #252525;
      padding: 2px;
      border-radius: 3px;
    }
    .weight-input {
      width: 100%;
      padding: 8px;
      text-align: center;
      font-size: 14px;
      background: #1a1a1a;
      border: 1px solid var(--border);
      border-radius: 4px;
      color: white;
    }
    .weight-input::placeholder {
      color: #555;
    }
    .std-values {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
      margin-top: 15px;
      background: #252525;
      padding: 15px;
      border-radius: 8px;
    }
    .std-card {
      background: #333;
      padding: 12px;
      border-radius: 8px;
      text-align: center;
    }
    .std-card h4 {
      font-size: 12px;
      color: var(--accent);
      margin-bottom: 5px;
      font-weight: 600;
    }
    .std-card .value {
      font-size: 18px;
      font-weight: bold;
    }
    .summary-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      font-size: 13px;
    }
    .summary-table th, .summary-table td {
      padding: 8px;
      text-align: center;
      border: 1px solid var(--border);
    }
    .summary-table th {
      background: var(--primary);
      font-weight: bold;
    }
    .summary-table tr:nth-child(even) {
      background: #1a1a1a;
    }
    .summary-table .category-over { background: #521a1a; }
    .summary-table .category-over-std { background: #523a0a; }
    .summary-table .category-std-tu1 { background: #1a521a; }
    .summary-table .category-tu1-tu2 { background: #0a5252; }
    .summary-table .total-row { font-weight: bold; }
    .hidden {
      display: none;
    }
    .info-box {
      background: #252525;
      border-left: 4px solid var(--accent);
      padding: 15px;
      border-radius: 0 8px 8px 0;
      margin-top: 20px;
      font-size: 14px;
    }
    .info-box h3 {
      color: var(--accent);
      margin-bottom: 8px;
    }
    .data-info {
      background: #252525;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 15px;
      text-align: center;
    }
    .data-info h3 {
      color: var(--accent);
      margin-bottom: 10px;
    }
    .data-info p {
      margin: 5px 0;
      font-size: 14px;
    }
    .data-info .highlight {
      font-weight: bold;
      color: var(--primary);
    }
    .filler-tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      background: #1a1a1a;
      padding: 10px;
      border-radius: 8px;
    }
    .filler-tab {
      flex: 1;
      padding: 15px;
      border-radius: 8px;
      cursor: pointer;
      text-align: center;
      font-weight: bold;
      transition: all 0.3s;
    }
    .filler-tab.active {
      background: var(--filler1);
      color: white;
      box-shadow: 0 4px 8px rgba(33, 150, 243, 0.3);
    }
    .filler-tab:hover:not(.active) {
      background: #2a2a2a;
    }
    .filler-content {
      display: none;
    }
    .filler-content.active {
      display: block;
    }
    .filler-section {
      background: #1a1a1a;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
      border-left: 4px solid var(--filler1);
    }
    .filler-section.filler2 {
      border-left-color: var(--filler2);
    }
    .filler-section h3 {
      color: var(--filler1);
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid var(--border);
    }
    .filler-section.filler2 h3 {
      color: var(--filler2);
    }
    .progress-bar {
      background: #2a2a2a;
      border-radius: 20px;
      padding: 10px;
      margin: 10px 0;
    }
    .progress-bar div {
      background: var(--primary);
      height: 20px;
      border-radius: 20px;
      transition: width 0.3s;
    }
    .progress-text {
      text-align: center;
      font-size: 14px;
      margin-top: 5px;
      font-weight: bold;
    }
    .status-badge {
      display: inline-block;
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
    }
    .status-pass {
      background: #1a521a;
      color: white;
    }
    .status-fail {
      background: #521a1a;
      color: white;
    }
    .status-warning {
      background: #523a0a;
      color: white;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üìã Input Gramasi 125 Pcs - Quality Control</h1>
    </header>

    <div class="form-section">
      <div class="input-area">
        <div class="form-group">
          <label for="tanggal">Tanggal Produksi:</label>
          <input type="date" id="tanggal" required />
        </div>

        <div class="form-group">
          <label for="mesin">Mesin:</label>
          <select id="mesin" required>
            <option value="">-- Pilih Mesin --</option>
            <option value="Mesin 1">Mesin 1</option>
            <option value="Mesin 2">Mesin 2</option>
            <option value="Mesin 3">Mesin 3</option>
            <option value="Mesin 4">Mesin 4</option>
            <option value="Mesin 5">Mesin 5</option>
            <option value="Mesin 6">Mesin 6</option>
            <option value="Mesin 7">Mesin 7</option>
            <option value="Mesin 8">Mesin 8</option>
          </select>
        </div>

        <div class="data-info">
          <h3>üìä Informasi Data</h3>
          <p><span class="highlight">Mesin:</span> <span id="info-mesin">-</span></p>
          <p><span class="highlight">Tanggal:</span> <span id="info-tanggal">-</span></p>
        </div>

        <!-- FILLER 1 SECTION -->
        <div class="filler-section">
          <h3>üîµ FILLER 1</h3>
          
          <div class="progress-bar">
            <div id="progress-filler1" style="width: 0%"></div>
          </div>
          <div class="progress-text">
            <span id="progress-text-filler1">0/125</span>
            <span id="status-filler1" class="status-badge status-warning">BELUM LENGKAP</span>
          </div>

          <div class="form-group">
            <label>Input 125 Pcs Gramasi (gr):</label>
            <div class="grid-container" id="weights-grid-filler1">
              <!-- 125 input fields akan di-generate di sini -->
            </div>
          </div>
        </div>

        <!-- FILLER 2 SECTION -->
        <div class="filler-section filler2">
          <h3>üü¢ FILLER 2</h3>
          
          <div class="progress-bar">
            <div id="progress-filler2" style="width: 0%"></div>
          </div>
          <div class="progress-text">
            <span id="progress-text-filler2">0/125</span>
            <span id="status-filler2" class="status-badge status-warning">BELUM LENGKAP</span>
          </div>

          <div class="form-group">
            <label>Input 125 Pcs Gramasi (gr):</label>
            <div class="grid-container" id="weights-grid-filler2">
              <!-- 125 input fields akan di-generate di sini -->
            </div>
          </div>
        </div>

        <div class="std-values">
          <div class="std-card">
            <h4>STD</h4>
            <div class="value" id="std-value">79.20</div>
          </div>
          <div class="std-card">
            <h4>MIN STD</h4>
            <div class="value" id="min-std-value">78.70</div>
          </div>
          <div class="std-card">
            <h4>MAX STD</h4>
            <div class="value" id="max-std-value">82.70</div>
          </div>
          <div class="std-card">
            <h4>TU1</h4>
            <div class="value" id="tu1-value">74.70</div>
          </div>
          <div class="std-card">
            <h4>TU2</h4>
            <div class="value" id="tu2-value">70.20</div>
          </div>
        </div>

        <div class="btn-group">
          <button type="button" id="calculateBtn">üìä Hitung Summary</button>
          <button type="button" id="exportXlsxBtn" class="btn-secondary">üì• Ekspor XLSX</button>
        </div>

        <div class="btn-group">
          <button type="button" id="submitBtn" class="btn-success">üì§ Kirim ke Spreadsheet</button>
          <button type="button" id="resetBtn" class="btn-warning">üîÑ Reset Form</button>
        </div>

        <div id="message" class="message"></div>

        <div class="info-box">
          <h3>Panduan Pengisian</h3>
          <p>1. Pilih Mesin dan Tanggal Produksi</p>
          <p>2. Isi data Filler 1 (125 pcs) - otomatis format desimal</p>
          <p>3. Isi data Filler 2 (125 pcs) - otomatis format desimal</p>
          <p>4. Klik "Hitung Summary" untuk melihat analisis</p>
          <p>5. Kirim ke spreadsheet jika data sudah lengkap</p>
          <p><strong>üí° Tip:</strong> Ketik 3 digit angka, otomatis jadi desimal (contoh: 795 ‚Üí 79.5)</p>
        </div>
      </div>

      <div class="summary-area">
        <h2>üìä Ringkasan Analisis</h2>
        <div class="form-group">
          <label>Basic Data:</label>
          <table class="summary-table">
            <thead>
              <tr>
                <th>Parameter</th>
                <th>üîµ Filler 1</th>
                <th>üü¢ Filler 2</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Average</td>
                <td id="avg-filler1">-</td>
                <td id="avg-filler2">-</td>
              </tr>
              <tr>
                <td>Min (g)</td>
                <td id="min-filler1">-</td>
                <td id="min-filler2">-</td>
              </tr>
              <tr>
                <td>Max (g)</td>
                <td id="max-filler1">-</td>
                <td id="max-filler2">-</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="form-group">
          <label>ANALISA DATA:</label>
          <table class="summary-table">
            <thead>
              <tr>
                <th>Kategori</th>
                <th>üîµ Filler 1</th>
                <th>üü¢ Filler 2</th>
                <th>%Filler 1</th>
                <th>%Filler 2</th>
              </tr>
            </thead>
            <tbody>
              <tr class="category-over">
                <td>Over (>82.7gr)</td>
                <td id="over-filler1">0</td>
                <td id="over-filler2">0</td>
                <td id="over-pct1">0.00%</td>
                <td id="over-pct2">0.00%</td>
              </tr>
              <tr class="category-over-std">
                <td>Over - STD (82.7 - 79.2gr)</td>
                <td id="over-std-filler1">0</td>
                <td id="over-std-filler2">0</td>
                <td id="over-std-pct1">0.00%</td>
                <td id="over-std-pct2">0.00%</td>
              </tr>
              <tr class="category-std-tu1">
                <td>STD - TU1 (79.2 - 74.7gr)</td>
                <td id="std-tu1-filler1">0</td>
                <td id="std-tu1-filler2">0</td>
                <td id="std-tu1-pct1">0.00%</td>
                <td id="std-tu1-pct2">0.00%</td>
              </tr>
              <tr class="category-tu1-tu2">
                <td>TU1 - TU2 (74.7 - 70.2gr)</td>
                <td id="tu1-tu2-filler1">0</td>
                <td id="tu1-tu2-filler2">0</td>
                <td id="tu1-tu2-pct1">0.00%</td>
                <td id="tu1-tu2-pct2">0.00%</td>
              </tr>
              <tr class="total-row">
                <td>TOTAL (harus 125 pcs)</td>
                <td id="total-filler1">0</td>
                <td id="total-filler2">0</td>
                <td id="total-pct1">0.00%</td>
                <td id="total-pct2">0.00%</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="info-box">
          <h3>‚úÖ Status Kualitas</h3>
          <p><strong>Filler 1:</strong> <span id="quality-status1">BELUM DIHITUNG</span></p>
          <p><strong>Filler 2:</strong> <span id="quality-status2">BELUM DIHITUNG</span></p>
          <p><strong>Keseluruhan:</strong> <span id="overall-status">BELUM DIHITUNG</span></p>
        </div>

        <div class="info-box">
          <h3>Persyaratan Mutu</h3>
          <p><strong>PERATURAN 1:</strong> Average minimal harus mencapai STD (79.20gr)</p>
          <p><strong>PERATURAN 2:</strong> Maksimal 7 pcs dalam 125 yang Over (>82.7gr)</p>
          <p><strong>‚úÖ PASS:</strong> Kedua aturan terpenuhi</p>
          <p><strong>‚ùå FAIL:</strong> Salah satu aturan tidak terpenuhi</p>
        </div>
      </div>
    </div>
  </div>

  <!-- XLSX Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <script>
    // Konfigurasi STD
    const STD_CONFIG = {
      std: 79.20,
      minStd: 78.70,
      maxStd: 82.70,
      tu1: 74.70,
      tu2: 70.20
    };

    // Penyimpanan data untuk kedua filler
    const fillerData = {
      'Filler 1': [],
      'Filler 2': []
    };

    // Inisialisasi form
    document.addEventListener('DOMContentLoaded', () => {
      // Generate 125 input fields dengan nomor untuk kedua filler
      generateWeightInputs('Filler 1', 'weights-grid-filler1');
      generateWeightInputs('Filler 2', 'weights-grid-filler2');
      
      // Set today's date as default
      const today = new Date();
      const dateString = today.toISOString().split('T')[0];
      document.getElementById('tanggal').value = dateString;
      
      // Event listeners
      document.getElementById('mesin').addEventListener('change', updateInfo);
      document.getElementById('tanggal').addEventListener('change', updateInfo);
      document.getElementById('calculateBtn').addEventListener('click', calculateSummary);
      document.getElementById('exportXlsxBtn').addEventListener('click', exportToXLSX);
      document.getElementById('submitBtn').addEventListener('click', submitToSheets);
      document.getElementById('resetBtn').addEventListener('click', resetForm);
      
      // Initial update
      updateInfo();
    });

    function generateWeightInputs(fillerName, gridId) {
      const grid = document.getElementById(gridId);
      grid.innerHTML = '';
      
      for (let i = 1; i <= 125; i++) {
        const wrapper = document.createElement('div');
        wrapper.className = 'weight-input-wrapper';
        
        const label = document.createElement('span');
        label.className = 'weight-input-label';
        label.textContent = i;
        
        const input = document.createElement('input');
        input.type = 'text'; // Ganti ke text untuk auto-format
        input.className = 'weight-input';
        input.placeholder = '0.00';
        input.dataset.index = i;
        input.dataset.filler = fillerName;
        
        // Auto format saat input
        input.addEventListener('input', (e) => {
          autoFormatDecimal(e.target);
          updateProgress();
          updateInfo();
        });
        
        // Format saat blur (keluar dari input)
        input.addEventListener('blur', (e) => {
          if (e.target.value) {
            e.target.value = parseFloat(e.target.value).toFixed(2);
          }
        });
        
        wrapper.appendChild(label);
        wrapper.appendChild(input);
        grid.appendChild(wrapper);
      }
    }

    function autoFormatDecimal(input) {
      let value = input.value.replace(/[^0-9]/g, '');
      
      if (value.length > 2) {
        // Tambahkan titik desimal sebelum 2 digit terakhir
        value = value.slice(0, -2) + '.' + value.slice(-2);
      } else if (value.length === 2) {
        // Tambahkan 0 di depan jika hanya 2 digit
        value = '0.' + value;
      } else if (value.length === 1) {
        // Tambahkan 0.0 di depan jika hanya 1 digit
        value = '0.0' + value;
      }
      
      input.value = value;
      
      // Validasi background color
      if (value && !isNaN(value)) {
        input.style.backgroundColor = '#2a2a2a';
      } else {
        input.style.backgroundColor = '#1a1a1a';
      }
    }

    function updateProgress() {
      // Update Filler 1
      const filled1 = Array.from(document.querySelectorAll('#weights-grid-filler1 .weight-input'))
        .filter(input => input.value && !isNaN(input.value)).length;
      const progress1 = (filled1 / 125) * 100;
      document.getElementById('progress-filler1').style.width = progress1 + '%';
      document.getElementById('progress-text-filler1').textContent = `${filled1}/125`;
      
      // Update status
      const status1 = filled1 === 125 ? 'status-pass' : filled1 > 0 ? 'status-warning' : 'status-warning';
      document.getElementById('status-filler1').className = 'status-badge ' + status1;
      document.getElementById('status-filler1').textContent = filled1 === 125 ? 'LENGKAP ‚úì' : filled1 > 0 ? 'DALAM PROSES' : 'BELUM LENGKAP';
      
      // Update Filler 2
      const filled2 = Array.from(document.querySelectorAll('#weights-grid-filler2 .weight-input'))
        .filter(input => input.value && !isNaN(input.value)).length;
      const progress2 = (filled2 / 125) * 100;
      document.getElementById('progress-filler2').style.width = progress2 + '%';
      document.getElementById('progress-text-filler2').textContent = `${filled2}/125`;
      
      const status2 = filled2 === 125 ? 'status-pass' : filled2 > 0 ? 'status-warning' : 'status-warning';
      document.getElementById('status-filler2').className = 'status-badge ' + status2;
      document.getElementById('status-filler2').textContent = filled2 === 125 ? 'LENGKAP ‚úì' : filled2 > 0 ? 'DALAM PROSES' : 'BELUM LENGKAP';
    }

    function updateInfo() {
      const mesin = document.getElementById('mesin').value;
      const tanggal = document.getElementById('tanggal').value;
      
      document.getElementById('info-mesin').textContent = mesin || '-';
      
      if (tanggal) {
        const dateObj = new Date(tanggal);
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        document.getElementById('info-tanggal').textContent = dateObj.toLocaleDateString('id-ID', options);
      } else {
        document.getElementById('info-tanggal').textContent = '-';
      }
      
      updateProgress();
    }

    function calculateSummary() {
      const mesin = document.getElementById('mesin').value;
      const tanggal = document.getElementById('tanggal').value;
      
      if (!mesin || !tanggal) {
        showMessage('‚ö†Ô∏è Pilih Mesin dan Tanggal terlebih dahulu', 'warning');
        return;
      }
      
      // Hitung untuk Filler 1
      const weights1 = Array.from(document.querySelectorAll('#weights-grid-filler1 .weight-input'))
        .map(input => parseFloat(input.value) || null)
        .filter(value => value !== null);
      
      if (weights1.length === 0) {
        showMessage('‚ö†Ô∏è Filler 1: Masukkan minimal 1 berat untuk perhitungan', 'warning');
        return;
      }
      
      if (weights1.length < 125) {
        showMessage(`‚ö†Ô∏è Filler 1: Data tidak lengkap (${weights1.length}/125 pcs)`, 'warning');
        return;
      }
      
      // Hitung untuk Filler 2
      const weights2 = Array.from(document.querySelectorAll('#weights-grid-filler2 .weight-input'))
        .map(input => parseFloat(input.value) || null)
        .filter(value => value !== null);
      
      if (weights2.length === 0) {
        showMessage('‚ö†Ô∏è Filler 2: Masukkan minimal 1 berat untuk perhitungan', 'warning');
        return;
      }
      
      if (weights2.length < 125) {
        showMessage(`‚ö†Ô∏è Filler 2: Data tidak lengkap (${weights2.length}/125 pcs)`, 'warning');
        return;
      }
      
      showMessage('‚úÖ Data lengkap untuk kedua filler (125/125 pcs)', 'success');
      
      // Simpan data
      fillerData['Filler 1'] = [...weights1];
      fillerData['Filler 2'] = [...weights2];
      
      // Hitung Filler 1
      calculateFiller('Filler 1', weights1);
      // Hitung Filler 2
      calculateFiller('Filler 2', weights2);
      
      // Update STD values in UI
      document.getElementById('std-value').textContent = STD_CONFIG.std.toFixed(2);
      document.getElementById('min-std-value').textContent = STD_CONFIG.minStd.toFixed(2);
      document.getElementById('max-std-value').textContent = STD_CONFIG.maxStd.toFixed(2);
      document.getElementById('tu1-value').textContent = STD_CONFIG.tu1.toFixed(2);
      document.getElementById('tu2-value').textContent = STD_CONFIG.tu2.toFixed(2);
      
      // Update quality status
      updateQualityStatus();
    }

    function calculateFiller(fillerName, weights) {
      // Basic calculations
      const average = weights.reduce((sum, val) => sum + val, 0) / weights.length;
      const min = Math.min(...weights);
      const max = Math.max(...weights);
      
      // Categorize weights
      const categories = {
        over: 0,
        overStd: 0,
        stdTu1: 0,
        tu1Tu2: 0
      };
      
      weights.forEach(weight => {
        if (weight > STD_CONFIG.maxStd) {
          categories.over++;
        } else if (weight > STD_CONFIG.std) {
          categories.overStd++;
        } else if (weight > STD_CONFIG.tu1) {
          categories.stdTu1++;
        } else if (weight > STD_CONFIG.tu2) {
          categories.tu1Tu2++;
        }
      });
      
      // Update UI
      const fillerNum = fillerName === 'Filler 1' ? '1' : '2';
      
      document.getElementById(`avg-filler${fillerNum}`).textContent = average.toFixed(2);
      document.getElementById(`min-filler${fillerNum}`).textContent = min.toFixed(2);
      document.getElementById(`max-filler${fillerNum}`).textContent = max.toFixed(2);
      
      // Update categories
      document.getElementById(`over-filler${fillerNum}`).textContent = categories.over;
      document.getElementById(`over-std-filler${fillerNum}`).textContent = categories.overStd;
      document.getElementById(`std-tu1-filler${fillerNum}`).textContent = categories.stdTu1;
      document.getElementById(`tu1-tu2-filler${fillerNum}`).textContent = categories.tu1Tu2;
      document.getElementById(`total-filler${fillerNum}`).textContent = weights.length;
      
      // Calculate percentages
      const total = weights.length;
      if (total > 0) {
        document.getElementById(`over-pct${fillerNum}`).textContent = ((categories.over / total) * 100).toFixed(2) + '%';
        document.getElementById(`over-std-pct${fillerNum}`).textContent = ((categories.overStd / total) * 100).toFixed(2) + '%';
        document.getElementById(`std-tu1-pct${fillerNum}`).textContent = ((categories.stdTu1 / total) * 100).toFixed(2) + '%';
        document.getElementById(`tu1-tu2-pct${fillerNum}`).textContent = ((categories.tu1Tu2 / total) * 100).toFixed(2) + '%';
        document.getElementById(`total-pct${fillerNum}`).textContent = '100.00%';
      }
    }

    function updateQualityStatus() {
      // Filler 1
      const avg1 = parseFloat(document.getElementById('avg-filler1').textContent);
      const over1 = parseInt(document.getElementById('over-filler1').textContent);
      const status1 = (over1 <= 7 && avg1 >= STD_CONFIG.std) ? '‚úÖ PASS' : '‚ùå FAIL';
      document.getElementById('quality-status1').textContent = status1;
      document.getElementById('quality-status1').style.color = status1.includes('PASS') ? '#4CAF50' : '#F44336';
      
      // Filler 2
      const avg2 = parseFloat(document.getElementById('avg-filler2').textContent);
      const over2 = parseInt(document.getElementById('over-filler2').textContent);
      const status2 = (over2 <= 7 && avg2 >= STD_CONFIG.std) ? '‚úÖ PASS' : '‚ùå FAIL';
      document.getElementById('quality-status2').textContent = status2;
      document.getElementById('quality-status2').style.color = status2.includes('PASS') ? '#4CAF50' : '#F44336';
      
      // Overall
      if (status1.includes('PASS') && status2.includes('PASS')) {
        document.getElementById('overall-status').textContent = '‚úÖ KEDUA FILLER PASS';
        document.getElementById('overall-status').style.color = '#4CAF50';
      } else if (status1.includes('FAIL') && status2.includes('FAIL')) {
        document.getElementById('overall-status').textContent = '‚ùå KEDUA FILLER FAIL';
        document.getElementById('overall-status').style.color = '#F44336';
      } else {
        document.getElementById('overall-status').textContent = '‚ö†Ô∏è SALAH SATU FAIL';
        document.getElementById('overall-status').style.color = '#FF9800';
      }
    }

    function exportToXLSX() {
      const mesin = document.getElementById('mesin').value;
      const tanggal = document.getElementById('tanggal').value;
      
      if (!mesin || !tanggal) {
        showMessage('‚ö†Ô∏è Pilih Mesin dan Tanggal terlebih dahulu', 'warning');
        return;
      }
      
      // Cek apakah sudah dihitung
      if (document.getElementById('avg-filler1').textContent === '-') {
        showMessage('‚ö†Ô∏è Klik "Hitung Summary" terlebih dahulu', 'warning');
        return;
      }
      
      // Create workbook
      const wb = XLSX.utils.book_new();
      
      // Sheet 1: Filler 1 Data
      const weights1 = Array.from(document.querySelectorAll('#weights-grid-filler1 .weight-input'))
        .map(input => parseFloat(input.value) || '');
      
      const wsData1 = [
        ['No', 'Gramasi (gr)'],
        ...weights1.map((value, index) => [index + 1, value])
      ];
      
      const ws1 = XLSX.utils.aoa_to_sheet(wsData1);
      
      // Sheet 2: Filler 2 Data
      const weights2 = Array.from(document.querySelectorAll('#weights-grid-filler2 .weight-input'))
        .map(input => parseFloat(input.value) || '');
      
      const wsData2 = [
        ['No', 'Gramasi (gr)'],
        ...weights2.map((value, index) => [index + 1, value])
      ];
      
      const ws2 = XLSX.utils.aoa_to_sheet(wsData2);
      
      // Sheet 3: Summary
      const summaryData = [
        ['LAPORAN GRAMASI 125 PCS'],
        ['Mesin', mesin],
        ['Tanggal', tanggal],
        [],
        ['RINGKASAN ANALISIS'],
        ['Parameter', 'üîµ Filler 1', 'üü¢ Filler 2'],
        ['Average', document.getElementById('avg-filler1').textContent, document.getElementById('avg-filler2').textContent],
        ['Min (g)', document.getElementById('min-filler1').textContent, document.getElementById('min-filler2').textContent],
        ['Max (g)', document.getElementById('max-filler1').textContent, document.getElementById('max-filler2').textContent],
        [],
        ['ANALISA DATA'],
        ['Kategori', 'üîµ Filler 1', 'üü¢ Filler 2', '%Filler 1', '%Filler 2'],
        ['Over (>82.7gr)', 
          document.getElementById('over-filler1').textContent,
          document.getElementById('over-filler2').textContent,
          document.getElementById('over-pct1').textContent,
          document.getElementById('over-pct2').textContent],
        ['Over-STD (82.7-79.2gr)',
          document.getElementById('over-std-filler1').textContent,
          document.getElementById('over-std-filler2').textContent,
          document.getElementById('over-std-pct1').textContent,
          document.getElementById('over-std-pct2').textContent],
        ['STD-TU1 (79.2-74.7gr)',
          document.getElementById('std-tu1-filler1').textContent,
          document.getElementById('std-tu1-filler2').textContent,
          document.getElementById('std-tu1-pct1').textContent,
          document.getElementById('std-tu1-pct2').textContent],
        ['TU1-TU2 (74.7-70.2gr)',
          document.getElementById('tu1-tu2-filler1').textContent,
          document.getElementById('tu1-tu2-filler2').textContent,
          document.getElementById('tu1-tu2-pct1').textContent,
          document.getElementById('tu1-tu2-pct2').textContent],
        ['TOTAL', 
          document.getElementById('total-filler1').textContent,
          document.getElementById('total-filler2').textContent,
          document.getElementById('total-pct1').textContent,
          document.getElementById('total-pct2').textContent],
        [],
        ['STATUS KUALITAS'],
        ['Filler 1', document.getElementById('quality-status1').textContent],
        ['Filler 2', document.getElementById('quality-status2').textContent],
        ['Keseluruhan', document.getElementById('overall-status').textContent]
      ];
      
      const summaryWs = XLSX.utils.aoa_to_sheet(summaryData);
      
      // Add sheets to workbook
      XLSX.utils.book_append_sheet(wb, ws1, "Filler 1 Data");
      XLSX.utils.book_append_sheet(wb, ws2, "Filler 2 Data");
      XLSX.utils.book_append_sheet(wb, summaryWs, "Summary");
      
      // Export
      XLSX.writeFile(wb, `Laporan_Gramasi_${mesin}_${new Date().toISOString().slice(0,10)}.xlsx`);
      showMessage('‚úÖ Data berhasil diekspor ke XLSX', 'success');
    }

    function submitToSheets() {
      const mesin = document.getElementById('mesin').value;
      const tanggal = document.getElementById('tanggal').value;
      
      if (!mesin || !tanggal) {
        showMessage('‚ö†Ô∏è Pilih Mesin dan Tanggal terlebih dahulu', 'warning');
        return;
      }
      
      // Cek apakah sudah dihitung
      if (document.getElementById('avg-filler1').textContent === '-') {
        showMessage('‚ö†Ô∏è Klik "Hitung Summary" terlebih dahulu', 'warning');
        return;
      }
      
      const btn = document.getElementById('submitBtn');
      const original = btn.textContent;
      btn.textContent = 'Mengirim...';
      btn.disabled = true;
      
      // Prepare data for Filler 1
      const weights1 = Array.from(document.querySelectorAll('#weights-grid-filler1 .weight-input'))
        .map(input => input.value);
      
      // Prepare data for Filler 2
      const weights2 = Array.from(document.querySelectorAll('#weights-grid-filler2 .weight-input'))
        .map(input => input.value);
      
      const formData = new FormData();
      formData.append('tanggal', tanggal);
      formData.append('mesin', mesin);
      
      // Add Filler 1 data
      formData.append('filler1_total', weights1.length);
      weights1.forEach((weight, index) => {
        formData.append(`filler1_weight${index + 1}`, weight);
      });
      formData.append('filler1_average', document.getElementById('avg-filler1').textContent);
      formData.append('filler1_min', document.getElementById('min-filler1').textContent);
      formData.append('filler1_max', document.getElementById('max-filler1').textContent);
      formData.append('filler1_over', document.getElementById('over-filler1').textContent);
      formData.append('filler1_overStd', document.getElementById('over-std-filler1').textContent);
      formData.append('filler1_stdTu1', document.getElementById('std-tu1-filler1').textContent);
      formData.append('filler1_tu1Tu2', document.getElementById('tu1-tu2-filler1').textContent);
      
      // Add Filler 2 data
      formData.append('filler2_total', weights2.length);
      weights2.forEach((weight, index) => {
        formData.append(`filler2_weight${index + 1}`, weight);
      });
      formData.append('filler2_average', document.getElementById('avg-filler2').textContent);
      formData.append('filler2_min', document.getElementById('min-filler2').textContent);
      formData.append('filler2_max', document.getElementById('max-filler2').textContent);
      formData.append('filler2_over', document.getElementById('over-filler2').textContent);
      formData.append('filler2_overStd', document.getElementById('over-std-filler2').textContent);
      formData.append('filler2_stdTu1', document.getElementById('std-tu1-filler2').textContent);
      formData.append('filler2_tu1Tu2', document.getElementById('tu1-tu2-filler2').textContent);
      
      // Quality status
      formData.append('filler1_status', document.getElementById('quality-status1').textContent);
      formData.append('filler2_status', document.getElementById('quality-status2').textContent);
      formData.append('overall_status', document.getElementById('overall-status').textContent);
      
      // Google Apps Script URL
      const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbw2GuEwFtq-PU-2RqzLL009ufyFPkOTsRAKrjuQjfEx-oAiZmWwmCnaMZw-TtBaolOv/exec';
      
      fetch(SCRIPT_URL, { method: 'POST', body: formData })
        .then(r => r.json())
        .then(d => {
          showMessage('‚úÖ Data berhasil dikirim ke spreadsheet!', 'success');
        })
        .catch(e => {
          console.error(e);
          showMessage('‚ùå Gagal mengirim data ke spreadsheet.', 'error');
        })
        .finally(() => {
          btn.textContent = original;
          btn.disabled = false;
        });
    }

    function resetForm() {
      if (!confirm('Yakin ingin reset form? Semua data akan hilang!')) {
        return;
      }
      
      // Reset selects
      document.getElementById('mesin').value = '';
      document.getElementById('tanggal').value = '';
      
      // Clear all weight inputs for Filler 1
      document.querySelectorAll('#weights-grid-filler1 .weight-input').forEach(input => {
        input.value = '';
        input.style.backgroundColor = '#1a1a1a';
      });
      
      // Clear all weight inputs for Filler 2
      document.querySelectorAll('#weights-grid-filler2 .weight-input').forEach(input => {
        input.value = '';
        input.style.backgroundColor = '#1a1a1a';
      });
      
      // Reset summary
      document.getElementById('avg-filler1').textContent = '-';
      document.getElementById('avg-filler2').textContent = '-';
      document.getElementById('min-filler1').textContent = '-';
      document.getElementById('min-filler2').textContent = '-';
      document.getElementById('max-filler1').textContent = '-';
      document.getElementById('max-filler2').textContent = '-';
      
      // Reset categories
      document.getElementById('over-filler1').textContent = '0';
      document.getElementById('over-filler2').textContent = '0';
      document.getElementById('over-std-filler1').textContent = '0';
      document.getElementById('over-std-filler2').textContent = '0';
      document.getElementById('std-tu1-filler1').textContent = '0';
      document.getElementById('std-tu1-filler2').textContent = '0';
      document.getElementById('tu1-tu2-filler1').textContent = '0';
      document.getElementById('tu1-tu2-filler2').textContent = '0';
      document.getElementById('total-filler1').textContent = '0';
      document.getElementById('total-filler2').textContent = '0';
      
      // Reset percentages
      document.getElementById('over-pct1').textContent = '0.00%';
      document.getElementById('over-pct2').textContent = '0.00%';
      document.getElementById('over-std-pct1').textContent = '0.00%';
      document.getElementById('over-std-pct2').textContent = '0.00%';
      document.getElementById('std-tu1-pct1').textContent = '0.00%';
      document.getElementById('std-tu1-pct2').textContent = '0.00%';
      document.getElementById('tu1-tu2-pct1').textContent = '0.00%';
      document.getElementById('tu1-tu2-pct2').textContent = '0.00%';
      document.getElementById('total-pct1').textContent = '0.00%';
      document.getElementById('total-pct2').textContent = '0.00%';
      
      // Reset quality status
      document.getElementById('quality-status1').textContent = 'BELUM DIHITUNG';
      document.getElementById('quality-status2').textContent = 'BELUM DIHITUNG';
      document.getElementById('overall-status').textContent = 'BELUM DIHITUNG';
      document.getElementById('quality-status1').style.color = '';
      document.getElementById('quality-status2').style.color = '';
      document.getElementById('overall-status').style.color = '';
      
      // Clear stored data
      fillerData['Filler 1'] = [];
      fillerData['Filler 2'] = [];
      
      // Clear message
      document.getElementById('message').className = 'message';
      document.getElementById('message').textContent = '';
      
      // Update info
      updateInfo();
    }

    function showMessage(text, type) {
      const message = document.getElementById('message');
      message.textContent = text;
      message.className = 'message ' + type;
      
      // Auto hide after 5 seconds
      setTimeout(() => {
        if (message.textContent === text) {
          message.className = 'message';
        }
      }, 5000);
    }
  </script>
</body>
</html>
